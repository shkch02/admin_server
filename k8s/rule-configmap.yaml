# rule-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: rule-policy-config
  namespace: default
data:
  rule.yaml: |
    ruleset_version: "1.0.0"
    description: "eBPF System Call based Security Violation Detection Rules"
    rules:
      - rule_id: "RULE_A01_HOST_CRITICAL_WRITE"
        description: "Detection of write access to critical host files (/etc/passwd, /etc/shadow, /etc/hosts)"
        conditions:
          - field: "syscall_name"
            operator: "equals"
            value: "openat"
          - field: "flags"
            operator: "contains_any"
            value:
              - "O_WRONLY"
              - "O_RDWR"
          - field: "file_path"
            operator: "starts_with_any"
            value:
              - "/etc/passwd"
              - "/etc/shadow"
              - "/etc/hosts"
      - rule_id: "RULE_B02_HOST_AUTH_READ"
        description: "Detection of read access to host authentication files (.ssh/id_rsa, .kube/config)"
        conditions:
          - field: "syscall_name"
            operator: "equals"
            value: "openat"
          - field: "flags"
            operator: "not_contains_any"
            value:
              - "O_WRONLY"
              - "O_RDWR"
          - field: "file_path"
            operator: "ends_with_any"
            value:
              - "/id_rsa"
              - "/known_hosts"
              - "/.ssh/config"
              - "/.kube/config"
      - rule_id: "RULE_C03_CONTAINER_ESCAPE_PATH"
        description: "Detection of access attempts to common container escape paths (/proc/sys, /sys/kernel)"
        conditions:
          - field: "syscall_name"
            operator: "equals"
            value: "openat"
          - field: "file_path"
            operator: "starts_with_any"
            value:
              - "/proc/sys/kernel/"
              - "/sys/kernel/"
